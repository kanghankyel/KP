<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org/DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.kidsplace.kidsplace.dao.CommunityDAO">

    <resultMap id="noticeMap" type="com.kidsplace.kidsplace.commons.NoticeVO">
        <result property="nNum" column="nNum" />
        <result property="nCategory" column="nCategory" />
        <result property="nWriter" column="nWriter" />
        <result property="nTitle" column="nTitle" />
        <result property="nContent" column="nContent" />
        <result property="nDate" column="nDate" />
        <result property="nDelete" column="nDelete" />
    </resultMap>

    <resultMap id="faqMap" type="com.kidsplace.kidsplace.commons.FaqVO">
        <result property="fNum" column="fNum" />
        <result property="uNum" column="uNum" />
        <result property="fTitle" column="fTitle" />
        <result property="fContent" column="fContent" />
        <result property="fDate" column="fDate" />
        <result property="fUpdate" column="fUpdate" />
        <result property="fDeleteDate" column="fDeleteDate" />
        <result property="fDelete" column="fDelete" />
    </resultMap>

    <resultMap id="qnaMap" type="com.kidsplace.kidsplace.commons.QnaVO">
        <result property="qNum" column="qNum" />
        <result property="qPhonenum" column="qPhonenum" />
        <result property="qPassword" column="qPassword" />
        <result property="qQuestionWriter" column="qQuestionWriter" />
        <result property="qQuestionTitle" column="qQuestionTitle" />
        <result property="qQuestionContent" column="qQuestionContent" />
        <result property="qQuestionDate" column="qQuestionDate" />
        <result property="qQuestionDeletedate" column="qQuestionDeletedate" />
        <result property="qQuestionDelete" column="qQuestionDelete" />
        <result property="qAnswerWriter" column="qAnswerWriter" />
        <result property="qAnswerTitle" column="qAnswerTitle" />
        <result property="qAnswerContent" column="qAnswerContent" />
        <result property="qAnswerDate" column="qAnswerDate" />
        <result property="qAnswerDeletedate" column="qAnswerDeletedate" />
        <result property="qAnswerDelete" column="qAnswerDelete" />
    </resultMap>

    <resultMap id="adminNoticeMap" type="com.kidsplace.kidsplace.commons.AdminNoticeVO">
        <result property="aNum" column="aNum" />
        <result property="aCategory" column="aCategory" />
        <result property="aWriter" column="aWriter" />
        <result property="aTitle" column="aTitle" />
        <result property="aContent" column="aContent" />
        <result property="aDate" column="aDate" />
        <result property="aDelete" column="aDelete" />
    </resultMap>

    <sql id="noticeSearch">
        <if test="@org.apache.commons.lang3.StringUtils@isNotBlank(noticeVO.nNum)">
            AND nNum LIKE '%' + #{ticketVO.nNum} + '%'
        </if>
        <if test="@org.apache.commons.lang3.StringUtils@isNotBlank(noticeVO.nCategory)">
            AND nCategory LIKE '%' + #{ticketVO.nCategory} + '%'
        </if>
        <if test="@org.apache.commons.lang3.StringUtils@isNotBlank(noticeVO.nWriter)">
            AND nWriter LIKE '%' + #{ticketVO.nWriter} + '%'
        </if>
        <if test="@org.apache.commons.lang3.StringUtils@isNotBlank(noticeVO.nTitle)">
            AND nTitle LIKE '%' + #{ticketVO.nTitle} + '%'
        </if>
        <if test="@org.apache.commons.lang3.StringUtils@isNotBlank(noticeVO.nContent)">
            AND nContent LIKE '%' + #{ticketVO.nContent} + '%'
        </if>
    </sql>

    <!--  공지사항 리스트 불러오기  -->
    <!-- <select id="noticeList" resultMap="noticeMap">
        SELECT
            nNum,nCategory,nWriter,nTitle,nContent,date_format(nDate, '%Y-%m-%d') AS nDate,nDelete
        FROM
            kidslandNotice
        WHERE
            nDelete = 'N'
        ORDER BY
            nNum;
    </select> -->

    <!-- 공지사항 리스트 페이징 -->
    <select id="noticePaging" resultMap="noticeMap">
        SELECT
            nNum
           ,nCategory
           ,nWriter
           ,nTitle
           ,nContent
           ,date_format(nDate, '%Y-%m-%d') AS nDate
           ,nDelete
        FROM
            kidslandNotice
        WHERE
            nDelete = 'N'
            <!-- <include refid="noticeSearch" /> -->
            <if test="@org.apache.commons.lang3.StringUtils@isNotBlank(noticeVO.nCategory)">
                AND nCategory LIKE CONCAT('%', #{noticeVO.nCategory}, '%')
            </if>
            <if test="@org.apache.commons.lang3.StringUtils@isNotBlank(noticeVO.nTitle)">
                AND nTitle LIKE CONCAT('%', #{noticeVO.nTitle}, '%')
            </if>
            <if test="@org.apache.commons.lang3.StringUtils@isNotBlank(noticeVO.nContent)">
                AND nContent LIKE CONCAT('%', #{noticeVO.nContent}, '%')
            </if>
        ORDER BY
            nNum DESC
        LIMIT
            #{pagination.limitStart}, #{pagination.recordSize}
    </select>

    <!-- 공지사항 리스트 카운팅 -->
    <select id="noticeCount" resultType="int">
        SELECT
            count(*)
        FROM
            kidslandNotice
        WHERE
            nDelete = 'N'
            <!-- <include refid="noticeSearch" /> -->
            <if test="@org.apache.commons.lang3.StringUtils@isNotBlank(noticeVO.nCategory)">
                AND nCategory LIKE CONCAT('%', #{noticeVO.nCategory}, '%')
            </if>
            <if test="@org.apache.commons.lang3.StringUtils@isNotBlank(noticeVO.nTitle)">
                AND nTitle LIKE CONCAT('%', #{noticeVO.nTitle}, '%')
            </if>
            <if test="@org.apache.commons.lang3.StringUtils@isNotBlank(noticeVO.nContent)">
                AND nContent LIKE CONCAT('%', #{noticeVO.nContent}, '%')
            </if>
    </select>

    <!--  공지사항 해당 항목 불러오기  -->
    <select id="noticeRead" resultMap="noticeMap">
        SELECT
            nNum,nCategory,nWriter,nTitle,nContent,date_format(nDate, '%Y/%m/%d') AS nDate,nDelete
        FROM
            kidslandNotice
        WHERE
            nDelete = 'N'
        AND
            nNum = #{nNum, jdbcType=VARCHAR}
    </select>

    <!-- 공지사항 작성 -->
    <insert id="noticeWrite">
        INSERT INTO
            kidslandNotice(nNum, nCategory, nWriter, nTitle, nContent)
        VALUES
            ((SELECT resultTable.resultNum FROM (SELECT IFNULL(MAX(nNum), 0) + 1 AS resultNum FROM kidslandNotice) resultTable)
            , #{nCategory}
            , #{nWriter}
            , #{nTitle}
            , #{nContent})
    </insert>

    <!-- 공지사항 수정 -->
    <update id="noticeEdit">
        UPDATE
            kidslandNotice
        SET
            nCategory = #{nCategory}
          , nWriter = #{nWriter}
          , nTitle = #{nTitle}
          , nContent = #{nContent}
          , nDate = CURRENT_TIMESTAMP
        WHERE
            nNum = #{nNum}
    </update>

    <!-- 공지사항 삭제 -->
    <update id="noticeDelete">
        UPDATE
            kidslandNotice
        SET
            nDelete = 'Y'
        WHERE
            nNum = #{nNum}
    </update>

    <!-- FAQ 리스트 페이징 -->
    <select id="faqPaging" resultMap="faqMap">
        SELECT
            fNum
           ,uNum
           ,fTitle
           ,fContent
           ,fDate
           ,fUpdate
           ,fDeleteDate
           ,fDelete
        FROM
            kidslandFaq
        WHERE
            fDelete = 'N'
        ORDER BY
            fNum DESC
        LIMIT
            #{pagination.limitStart}, #{pagination.recordSize}
    </select>

    <!-- FAQ 게시글 카운팅 -->
    <select id="faqCount" resultType="int">
        SELECT
            count(*)
        FROM
            kidslandFaq
        WHERE
            fDelete = 'N'
    </select>

    <!-- FAQ 쓰기 -->
    <insert id="faqWrite">
        INSERT INTO
            kidslandFaq(fNum, uNum, fTitle, fContent)
        VALUES
            ((SELECT resultTable.resultNum FROM (SELECT IFNULL(MAX(fNum), 0) + 1 AS resultNum FROM kidslandFaq) resultTable)
            , #{uNum}
            , #{fTitle}
            , #{fContent})
    </insert>
    
    <!-- FAQ 삭제 -->
    <update id="faqDelete">
        UPDATE
            kidslandFaq
        SET
            fDelete = 'Y'
        WHERE
            fNum = #{fNum}
    </update>

    <!-- 사내공지사항 페이징 -->
    <select id="adminNoticePaging" resultMap="adminNoticeMap">
        SELECT
            aNum
           ,aCategory
           ,aWriter
           ,aTitle
           ,aContent
           ,date_format(aDate, '%Y-%m-%d') AS aDate
           ,aDelete
        FROM
            kidslandAdminNotice
        WHERE
            aDelete = 'N'
            <!-- <include refid="noticeSearch" /> -->
            <if test="@org.apache.commons.lang3.StringUtils@isNotBlank(adminNoticeVO.aCategory)">
                AND aCategory LIKE CONCAT('%', #{adminNoticeVO.aCategory}, '%')
            </if>
            <if test="@org.apache.commons.lang3.StringUtils@isNotBlank(adminNoticeVO.aTitle)">
                AND aTitle LIKE CONCAT('%', #{adminNoticeVO.aTitle}, '%')
            </if>
            <if test="@org.apache.commons.lang3.StringUtils@isNotBlank(adminNoticeVO.aContent)">
                AND aContent LIKE CONCAT('%', #{adminNoticeVO.aContent}, '%')
            </if>
        ORDER BY
            aNum DESC
        LIMIT
            #{pagination.limitStart}, #{pagination.recordSize}
    </select>

    <!-- 사내공지사항 카운팅 -->
    <select id="adminNoticeCount" resultType="int">
        SELECT
            count(*)
        FROM
            kidslandAdminNotice
        WHERE
            aDelete = 'N'
            <!-- <include refid="noticeSearch" /> -->
            <if test="@org.apache.commons.lang3.StringUtils@isNotBlank(adminNoticeVO.aCategory)">
                AND aCategory LIKE CONCAT('%', #{adminNoticeVO.aCategory}, '%')
            </if>
            <if test="@org.apache.commons.lang3.StringUtils@isNotBlank(adminNoticeVO.aTitle)">
                AND aTitle LIKE CONCAT('%', #{adminNoticeVO.aTitle}, '%')
            </if>
            <if test="@org.apache.commons.lang3.StringUtils@isNotBlank(adminNoticeVO.aContent)">
                AND aContent LIKE CONCAT('%', #{adminNoticeVO.aContent}, '%')
            </if>
    </select>

    <!-- 사내공지사항 작성 -->
    <insert id="adminNoticeWrite">
        INSERT INTO
            kidslandAdminNotice(
                aNum
               ,aCategory
               ,aWriter
               ,aTitle
               ,aContent)
        VALUES
            ((SELECT resultTable.resultNum FROM (SELECT IFNULL(MAX(aNum), 0) + 1 AS resultNum FROM kidslandAdminNotice) resultTable)
            , #{aCategory}
            , #{aWriter}
            , #{aTitle}
            , #{aContent})
    </insert>

    <!-- 사내공지사항 상세 -->
    <select id="adminNoticeRead" resultMap="adminNoticeMap">
        SELECT
            aNum
           ,aCategory
           ,aWriter
           ,aTitle
           ,aContent
           ,date_format(aDate, '%Y/%m/%d') AS aDate
           ,aDelete
        FROM
            kidslandAdminNotice
        WHERE
            aDelete = 'N'
        AND
            aNum = #{aNum, jdbcType=VARCHAR}
    </select>

    <!-- 사내공지사항 수정 -->
    <update id="adminNoticeEdit">
        UPDATE
            kidslandAdminNotice
        SET
            aCategory = #{aCategory}
          , aWriter = #{aWriter}
          , aTitle = #{aTitle}
          , aContent = #{aContent}
          , aDate = CURRENT_TIMESTAMP
        WHERE
            aNum = #{aNum}
    </update>

    <!-- 사내공지사항 삭제 -->
    <update id="adminNoticeDelete">
        UPDATE
            kidslandAdminNotice
        SET
            aDelete = 'Y'
        WHERE
            aNum = #{aNum}
    </update>

    <!-- 관리자페이지 사내공지사항 리스트 -->
    <select id="adminNotice" resultMap="adminNoticeMap">
        SELECT
            aNum
           ,aTitle
           ,date_format(aDate, '%Y.%m.%d') AS aDate
        FROM
            kidslandAdminNotice
        WHERE
            aDelete = 'N'
        ORDER BY
            aNum DESC
        LIMIT
            6
    </select>

    <!-- 관리자페이지 Q&A 리스트 -->
    <select id="adminQna" resultMap="qnaMap">
        SELECT
            qNum
           ,qQuestionTitle
           ,date_format(qQuestionDate, '%Y.%m.%d') AS qQuestionDate
        FROM
            kidslandQna
        WHERE
            qQuestionDelete = 'N'
        ORDER BY
            qNum DESC
        LIMIT
            6
    </select>

    <!-- qna 리스트 페이징 -->
    <select id="qnaPaging" resultMap="qnaMap">
        SELECT
            qNum
           ,qQuestionWriter
           ,qPhonenum
           ,qPassword
           ,qQuestionTitle
           ,date_format(qQuestionDate, '%Y-%m-%d') AS qQuestionDate
        FROM
            kidslandQna
        WHERE
            qQuestionDelete = 'N'
            <if test="@org.apache.commons.lang3.StringUtils@isNotBlank(qnaVO.qPhonenum)">
                AND qPhonenum LIKE CONCAT('%', #{qnaVO.qPhonenum}, '%')
            </if>
            <if test="@org.apache.commons.lang3.StringUtils@isNotBlank(qnaVO.qQuestionWriter)">
                AND qQuestionWriter LIKE CONCAT('%', #{qnaVO.qQuestionWriter}, '%')
            </if>
            <if test="@org.apache.commons.lang3.StringUtils@isNotBlank(qnaVO.qQuestionTitle)">
                AND qQuestionTitle LIKE CONCAT('%', #{qnaVO.qQuestionTitle}, '%')
            </if>
        ORDER BY
            qNum DESC
        LIMIT
            #{pagination.limitStart}, #{pagination.recordSize}
    </select>

    <!-- qna 리스트 카운팅 -->
    <select id="qnaCount" resultType="int">
        SELECT
            count(*)
        FROM
            kidslandQna
        WHERE
            qQuestionDelete = 'N'
            <if test="@org.apache.commons.lang3.StringUtils@isNotBlank(qnaVO.qPhonenum)">
                AND qPhonenum LIKE CONCAT('%', #{qnaVO.qPhonenum}, '%')
            </if>
            <if test="@org.apache.commons.lang3.StringUtils@isNotBlank(qnaVO.qQuestionWriter)">
                AND qQuestionWriter LIKE CONCAT('%', #{qnaVO.qQuestionWriter}, '%')
            </if>
            <if test="@org.apache.commons.lang3.StringUtils@isNotBlank(qnaVO.qQuestionTitle)">
                AND qQuestionTitle LIKE CONCAT('%', #{qnaVO.qQuestionTitle}, '%')
            </if>
    </select>

    <!-- Qna 작성 -->
    <insert id="qnaWrite">
        INSERT INTO
            kidslandQna(
                qNum
               ,qQuestionWriter
               ,qPhonenum
               ,qPassword
               ,qQuestionTitle
               ,qQuestionContent)
        VALUES
            ((SELECT resultTable.resultNum FROM (SELECT IFNULL(MAX(qNum), 0) + 1 AS resultNum FROM kidslandQna) resultTable)
            , #{qQuestionWriter}
            , #{qPhonenum}
            , #{qPassword}
            , #{qQuestionTitle}
            , #{qQuestionContent})
    </insert>

    <!-- Qna 상세 -->
    <select id="qnaRead" resultMap="qnaMap">
        SELECT
            qNum
           ,qPhonenum
           ,qPassword
           ,qQuestionWriter
           ,qQuestionTitle
           ,qQuestionContent
           ,date_format(qQuestionDate, '%Y/%m/%d') AS qQuestionDate
           ,qAnswerWriter
           ,qAnswerTitle
           ,qAnswerContent
           ,date_format(qAnswerDate, '%Y/%m/%d') AS qAnswerDate
        FROM
            kidslandQna
        WHERE
            qQuestionDelete = 'N'
        AND
            qNum = #{qNum, jdbcType=VARCHAR}
    </select>

    <!-- Qna 삭제 -->
    <update id="qnaDelete">
        UPDATE
            kidslandQna
        SET
            qQuestionDelete = 'Y'
        WHERE
            qNum = #{qNum}
    </update>

    <!-- Qna 답변작성 -->
    <update id="qnaAnswer">
        UPDATE
            kidslandQna
        SET
            qAnswerWriter = #{qAnswerWriter}
          , qAnswerDate = CURRENT_TIMESTAMP
          , qAnswerContent = #{qAnswerContent}
        WHERE
            qNum = #{qNum}
    </update>

    <!-- Qna 답변삭제 -->
    <update id="qnaAnswerDelete">
        UPDATE
            kidslandQna
        SET
            qAnswerContent = NULL
        WHERE
            qNum = #{qNum}
    </update>
</mapper>