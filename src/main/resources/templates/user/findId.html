<!DOCTYPE html>
<html lang="ko"
      xmlns:th="http://www.thymeleaf.org">
<body>
    <div th:include="/fragment/head"></div>
    <div th:include="/fragment/header"></div>
    <div th:include="/fragment/nav"></div>

    <div class="content">
        <div class="inner">
            <h2>아이디 찾기</h2>
            <hr>
            <table>
                <tr>
                    <th><label for="uName">성명</label></th>
                    <td><input type="text" id="uName" name="uName"></td>
                </tr>
                <tr>
                    <th><label for="uPhoneNum">전화번호</label></th>
                    <td><input type="text" id="uPhoneNum" name="uPhoneNum"></td>
                </tr>
                <tr>
                    <td colspan="2"><input type="button" value="아이디 찾기" onclick="findId()"></td>
                </tr>
            </table>
            <input type="text" id="foundId" placeholder="찾은 아이디가 표시됩니다" readonly>
            <div>
                <a th:href="@{../user/login}">로그인</a>
                <a th:href="@{#}">비밀번호 찾기</a>
            </div>
        </div>
    </div>

    <div th:include="/fragment/footer"></div>



    <!--  ##################################  script  ##################################  -->
    <!--  아이디 찾기 비동기 script  -->
    <script>
        function findId() {
            let uName = document.getElementById("uName").value;
            let uPhoneNum = document.getElementById("uPhoneNum").value;
            
            fetch('/user/findId', {
                method: 'post',
                headers: {"Content-Type": "application/json"},
                body: JSON.stringify({
                    uName: uName,
                    uPhoneNum: uPhoneNum
                })
            })
            .then(response => {
                if (response.ok) {
                    return response.text();  // 텍스트로 변환하여 반환
                } else {
                    throw new Error('아이디를 찾는데 실패하였습니다.');
                }
            })
            .then(data => {
                document.getElementById("foundId").value = data;  // 찾은 아이디를 화면에 표시
                alert("해당하는 아이디를 찾았습니다.");
            })
            .catch(error => {
                console.log(error);
                alert("아이디를 찾는데 실패하였습니다. 다시 시도해주세요.");
            });
        }
    </script>
</body>
</html>